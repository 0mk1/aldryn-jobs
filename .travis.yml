language: python

python: 3.5

sudo: false

env:
  matrix:
    # Matrix-size reduction strategies:
    #   PY strategy: do not test 3.3 at all.
    #   DB strategy: only with SQLite as we're not using any raw queries.
    #   FE strategy: only test on Django/CMS combinations, but place tests on
    #                different Python ENVs if possible.
    - TOXENV=flake8
    - TOXENV=py35-dj19-sqlite-cms34
    - TOXENV=py35-dj19-sqlite-cms33-fe FE=1
    - TOXENV=py35-dj19-sqlite-cms32
    - TOXENV=py34-dj19-sqlite-cms34
    - TOXENV=py34-dj19-sqlite-cms33
    - TOXENV=py34-dj19-sqlite-cms32
    - TOXENV=py27-dj19-sqlite-cms34
    - TOXENV=py27-dj19-sqlite-cms33
    - TOXENV=py27-dj19-sqlite-cms32
    - TOXENV=py35-dj18-sqlite-cms34
    - TOXENV=py35-dj18-sqlite-cms33
    - TOXENV=py35-dj18-sqlite-cms32
    - TOXENV=py34-dj18-sqlite-cms34
    - TOXENV=py34-dj18-sqlite-cms33
    - TOXENV=py34-dj18-sqlite-cms32
    - TOXENV=py27-dj18-sqlite-cms34
    - TOXENV=py27-dj18-sqlite-cms33-fe FE=1
    - TOXENV=py27-dj18-sqlite-cms32
    - TOXENV=py34-dj17-sqlite-cms32
    - TOXENV=py33-dj17-sqlite-cms32
    - TOXENV=py27-dj17-sqlite-cms32
    - TOXENV=py33-dj16-sqlite-cms32
    - TOXENV=py27-dj16-sqlite-cms32
    - TOXENV=py26-dj16-sqlite-cms32

cache:
  directories:
    - $HOME/.wheelhouse

install:
  - pip install tox
  - pip install coveralls

before_script:
  - if [ "$FE" == 1 ]; then nvm install 6 && nvm use 6; fi
  - if [ "$FE" == 1 ]; then npm config set spin false; fi
  - if [ "$FE" == 1 ]; then npm install -g gulp@3.9.0; fi
  - if [ "$FE" == 1 ]; then npm install -g codeclimate-test-reporter; fi
  - if [ "$FE" == 1 ]; then npm install; fi

script:
  - tox -e $TOXENV

after_script:
  - codeclimate < tests/coverage/**/lcov.info

after_success: coveralls

notifications:
  webhooks: http://addons.us-iad-rs.aldryn.io/en/travis-endpoint/
